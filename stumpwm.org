#+TITLE: stumpwm configuration
#+AUTHOR: calx

(made :with lisp)

#+BEGIN_SRC common-lisp :tangle init.lisp
  (in-package :stumpwm-user)
#+END_SRC

* modules

#+BEGIN_SRC common-lisp :tangle init.lisp
  (load-module "cpu")
  (load-module "mem")
  (load-module "net")
  (load-module "stumptray")
#+END_SRC

* commands

** system commands

#+BEGIN_SRC common-lisp :tangle init.lisp
  (define-stumpwm-type :system-commands (input prompt)
    (let ((cmds '(("sleep"	:sleep)
  		("lock"		:lock)
  		("reboot"	:reboot)
  		("power-off"	:power-off)
  		("shutdown"	:power-off))))
      (or (second (assoc (argument-pop-or-read input prompt (mapcar #'first cmds))
  		       cmds :test #'string=))
  	(throw 'error :abort))))

  (defcommand system (cmd)
      ((:system-commands "Pick a system command: "))
    (case cmd
      (:lock	(run-shell-command "xsecurelock"))
      (:power-off (run-shell-command "shutdown now" t))
      (:reboot	(run-shell-command "reboot" t))
      (:sleep	(run-shell-command "systemctl sleep" t))
      (t (throw 'error "invalid system command"))))
#+END_SRC

** volume commands

#+BEGIN_SRC common-lisp :tangle init.lisp
  (ql:quickload :yason)

  (defun volume--default-sink-name ()
    (gethash "default_sink_name" (yason:parse (run-shell-command "pactl -f json info" t))))

  (defun volume--get-sink (&optional (sink-name (volume--default-sink-name)))
    (find sink-name (gethash "sinks" (yason:parse (run-shell-command "pactl -f json list" t)))
  	:test #'string=
  	:key #'(lambda (sink) (gethash "name" sink))))

  (defun volume--get-sink-volume (&optional (sink (volume--get-sink)))
    (list
     (gethash "value_percent" (gethash "front-left" (gethash "volume" sink)))
     (gethash "value_percent" (gethash "front-right" (gethash "volume" sink)))
     (gethash "mute" sink)))

  (defun volume-show ()
    (message "窒陶团窿ネ赵拍痕铒基弩蔺鲲祯礤珏舡箝铍鲲祯礤┅ㄤ彐轭瀛篝蹴瘅憝豉疱忽镬蹴瀛泔眄犷潴ㄩ铕豸痱镯痿戾舄è沩潴Жá轭泸遽箦洪钽蝈狍舂á轭恽洪钽蝈狍舂á溴泸遽箦轰邈蝈狍舂á溴恽轰邈蝈狍舂á箬秣后栾铋飑á麸珑戾眭翦呼镧珈瀛眭翦铋飑á骘蜚瀛眭翦烘矧沐眭翦铋飑┅ㄣ栾殂矧ㄡ篌镢ㄡ蜱蹴孱舡痫瓠矧蝈徜轭瘐痱镯痿磲疸狎＇骈蝮沩潴┅沩潴呼弩＇篝蜷铉僵翳蝻у蝌矧㈤铞犰殇鲲祯礤泔眄犷洧┅┅ㄩ翳轵汨镩沐扉篝箦泔钿汨镩沐疳蝮瀛轭翦珏ㄡ蜱蹴孱舡痫瓠矧蝈徜轭瘐⑴铘弪溴祠岷宏躅氕犰祜麇铋飑扉篝箦泔钿汨镩沐铋飑┅ㄤ彐泔眄犷鲲祯礤ㄣ礓è忽镬蹴瀛泔眄犷潴⑿殂鲲祯礤泔眄犷浜┅ㄣ狍ㄦ轵篝沩洎ê箬秣鲲祯礤箬秣┅ê麸珑戾眭翦蝓瞽箬屐飙泔眄犷疳泗箦舡箝铍眭翦滥牌琳淘哂晌死麸珑戾舂鲲祯礤箬秣┅ê骘蜚瀛眭翦蝓瞽箬屐飙泔眄犷疳泗箦舡箝铍眭翦滥牌琳淘哂晌死弩舂鲲祯礤箬秣┅ê轭泸遽箦ㄣ桢汶豉疱箦泔钿沩洎轭翦珏颟蝓瞽箬屐飙泔眄犷ㄦ矧磲铋疳泗箦舡箝铍鲲祯礤滥牌琳淘哂晌死磨箦泔钿沩洎舂鲲祯礤箬秣┅ê溴泸遽箦ㄣ桢汶豉疱箦泔钿沩洎轭翦珏颟蝓瞽箬屐飙泔眄犷ㄦ矧磲铋疳泗箦舡箝铍鲲祯礤滥牌琳淘哂晌死磨箦泔钿沩洎舂鲲祯礤箬秣┅翳蝻у蝌矧㈤铞犰殇鲲祯礤泔眄犷洧┅┅＋盼倪右痨狴弪泔铘蝻祗＋屡巧芜右泔眄镱扉箴呼犷珈轭轸扉箴ㄤ彐躅痨狴弪箬秣ī礤篌徵蝓瞽箬屐飙泔眄犷痨狴弪泗礤翎溽翎骘蝽狒糸綮妪溴驷蹯舁狎糸篝堍减铍铒黝狎糸篝拒溴驷蹯舁犰怩憩堍减铍铒黝犰怩砭堍煦篝狒躞镱痨狴弪吾礤漉蜥糸镱痫箝糸镱镦漉蜥糸镱眇蜷蠛戾铉翳┃舂┅ㄤ彐轭瀛篝蹴瘅憝豉疱吼灬弪泔眄犷潴ㄩ铕豸痱镯痿戾è沩潴Жá箬秣后栾鳗á痨狴吼灬á疳躞澧吼狨箦á痨狴疳躞澧吼灬疳躞濠á麸珑戾痨狴吼灬疳躞濠á痱弼轱躞吼蝈鲩秕螬á痱弼吼蝈鲩秕螬á铄簪侯屮舂á篝镳后麸皓┅矧箦泔钿ㄡ篌镢ㄡ蜱蹴孱舡痫瓠矧蝈徜轭瘐痱镯痿磲疸狎＇骈蝮沩潴┅沩潴呼弩＇篝蜷铉僵翳蝻у蝌矧横怙螋┅┅ㄤ彐泔眄犷痨狴弪ㄣ礓è吼灬弪泔眄犷潴⑿殂痨狴弪泔眄犷浜┅ㄣ狍沩ê箬秣痨狴弪箬秣┅è吼灬吼狨箦吼灬疳躞吼蝈鲩秕侯屮后麸皓蝓瞽箬屐飙泔眄犷ㄦ矧磲铋痨狴弪泗窿沩洎舂痨狴弪箬秣┅翳蝻у蝌矧㈤铞犰殇痨狴弪泔眄犷洧┅┅＋盼倪右脲箦趱蝻雉磲＋屡巧芜右泔眄镱扉箴呼犷珈轭轸扉箴箦舡痱彐轼脲脞Ⅲ簪┅ㄤ彐轭瀛脲蝻雉磲皙脞ⅡⅡ弩翎螋栳蜾＋盼倪右盹糸镱脲＋屡巧芜右泔眄镱扉箴呼犷珈轭轸扉箴ㄤ彐轭瀛脲麸瓠磲皙脞Ⅲ辎㈡铄簪ㄤ彐轭瀛脲麸瓠磲皙脞Ⅲ擘㈡痱弼ㄤ彐轭瀛脲麸瓠磲皙脞Ⅲ睥瘐祆栝滗孱铄簪ㄤ彐轭瀛脲麸瓠磲皙脞Ⅲ稷瘐祆栝滗孱痱弼轱躞ㄤ彐轭瀛脲麸瓠磲皙脞Ⅲ茛㈢铄簪ㄤ彐轭瀛脲麸瓠磲皙脞Ⅲ邰㈢痱弼＋盼倪右痱镧蜥脲＋屡巧芜右泔眄镱扉箴呼犷珈轭轸扉箴ㄤ彐轭瀛脲麸瓠磲皙脞Ⅲ遗寓㈠邈犰徙蜷趑ㄤ彐轭瀛脲麸瓠磲皙脞Ⅲ㈠邈屙徙筱扉孱у磲泱Бㄤ彐轭瀛脲麸瓠磲皙脞Ⅲ冖㈠邈屙徙螈＋盼倪右雉桢脲＋屡巧芜右泔眄镱扉箴呼犷珈轭轸扉箴ㄤ彐轭瀛脲麸瓠磲皙脞Ⅲ洧㈠邈ㄤ彐轭瀛脲麸瓠磲皙脞Ⅲ恽㈠邈蝻骈箬秣潋躅ㄤ彐轭瀛脲麸瓠磲皙脞Ⅲ纰⑨怙螋＋盼倪右泔铘蝻祆弪脲＋屡巧芜右泔眄镱扉箴呼犷珈轭轸扉箴换鲲祯礤泔铘蝻ㄤ彐轭瀛脲麸瓠磲皙脞⒇聘读蹁轱王翦Ⅵ镬蹴麸珑戾眭翦ㄤ彐轭瀛脲麸瓠磲皙脞⒚仄付刘溟锿豸澧Ⅵ镬蹴骘蜚瀛眭翦ㄤ彐轭瀛脲麸瓠磲皙脞⒇聘读蹁轱裔轶逯镬蹴澧Ⅵ镬蹴轭卑ㄤ彐轭瀛脲麸瓠磲皙脞⒇聘读蹁轱田麇蛑镬蹴澧Ⅵ镬蹴溴卑ㄤ彐轭瀛脲麸瓠磲皙脞⒂仄付刘溟镆衢箦诛祯礤Ⅵ镬蹴轭并ㄤ彐轭瀛脲麸瓠磲皙脞⒂仄付刘溟锾秣弪诛祯礤Ⅵ镬蹴溴并换痨狴弪泔铘蝻ㄤ彐轭瀛脲麸瓠磲皙脞⒇聘读蹁轱徐狴痨狴弪麸珑戾痨狴ㄤ彐轭瀛脲麸瓠磲皙脞⒇聘读蹁轱序弼痨狴弪痱弼ㄤ彐轭瀛脲麸瓠磲皙脞⒇聘读蹁轱五簪痨狴弪铄簪换筱蝈孱箬雉ㄤ彐轭瀛脲麸瓠磲皙脞⒂躅序轭暨鱼蝈孱㈠邈筱蝻汜痿躜弩ベロヤ撺群ネ亥赢痤纰ㄤ彐轭瀛脲麸瓠磲皙脞⒚吁钚蜷铘哂泸邋睥㈠邈筱蝻汜痿躜弩苘ぷベロヤ撺群ネ亥赢痤纰ㄤ彐轭瀛脲麸瓠磲皙脞⑼吁钚蜷铘哂泸邋睥㈠邈筱蝻汜痿躜弩ベロヤ撺群ネ亥赢痤纰＋盼倪右簌篝屙脲＋屡巧芜右泔眄镱扉箴呼犷珈轭轸扉箴ㄤ彐鲠簌篝屙磲皙磲脲箴狎箦脲磲皓ㄤ彐轭瀛脲簌篝屙磲皙脞⒂Ⅲ篝屙痫麇颦镦姊ㄤ彐轭瀛脲簌篝屙磲皙脞ⅡⅢ篝屙蝈怙雉ㄤ彐轭瀛脲簌篝屙磲皙脞ⅢⅢ篝屙箪邋稷ㄤ彐轭瀛脲簌篝屙磲皙脞ⅧⅢ篝屙祜汶换ㄤ彐轭瀛脲蝻雉磲皙脞ⅧИ簌篝屙磲皙ㄤ彐轭瀛脲麸瓠磲皙脞ⅢИ簌篝屙磲皙＋盼倪右珧秕箦趱＋屡巧芜右泔眄镱扉箴呼犷珈轭轸扉箴ㄧ蝈钺礤㈣镯澧＋盼倪右盹溴扉铄箦趱＋屡巧芜右泔眄镱扉箴呼犷珈轭轸扉箴箦翩糸礤骘蝽狒篝蜷铉メモュベル亥秃ビ箦翩筱蝈孱盹溴扉铄骘蝽狒扉篝③ヮ茛ヶ⑥劲ッネレヤピ┅箦翩盹溴扉铄糸礤秕舄暴箦翩盹溴扉铄痫箝糸镱衡雉麸愆箦翩盹溴扉铄忉汶珧秕钿泔祜颡０鞍鞍阿箦翩盹溴扉铄骘蝈珧秕钿泔祜颡Ｆ破破脾＋盼倪右沭箦趱＋屡巧芜右泔眄镱扉箴呼犷珈轭轸扉箴箦翩沭鹾邯沭醐盹溴扉铄骓舄ャē姗＋盼倪右篝狎盹溴扉铄＋屡巧芜右泔眄镱扉箴呼犷珈轭轸扉箴盹溴扉铄＋盼倪右篝蹴痿蜥箦趱＋屡巧芜右泔眄镱扉箴呼犷珈轭轸扉箴箦翩篝蹴痿蜥汉趄狴鲩鏖瞽忉汶珧秕钿盹溴扉铄忉汶珧秕钿泔祜颡箦翩篝蹴痿蜥汉趄狴痨徙彖镬溴颦痖屐蟓疱颦箴徙濯珐篝蹴痿蜥汉篝蹴痿蜥＋盼倪右雉桢箦趱＋屡巧芜右泔眄镱扉箴呼犷珈轭轸扉箴箦翩盹躞瀛骘沲蟓痫扉泫后祜痧箦翩礤篌徵瀛鏖钿秣珧狯轸恒孱翦礤篌徵瀛鏖钿秣轭瘐舡珧狯轸恒孱翦轭瘐舡鏖钿秣珧狯轸恒孱翦颟＋盼倪右箴狩镱沐＋屡巧芜右泔眄镱扉箴呼犷珈轭轸扉箴祜镳骘沩轭扉篝驽桠纰Ⅷ箦趄镲沲蝮矧哳犴戾骠唣趄痖泔恝㈩憝狃痨弭漉铙簪滹蝓瞽箬屐飙泔眄犷沩洎＋盼倪右